<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>技术博客分享平台  --limHu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="技术博客分享平台  --limHu">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="技术博客分享平台  --limHu">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="技术博客分享平台  --limHu">
  
    <link rel="alternate" href="/atom.xml" title="技术博客分享平台  --limHu" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">技术博客分享平台  --limHu</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-前端项目服务器常用工具" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/26/前端项目服务器常用工具/" class="article-date">
  <time datetime="2018-12-26T09:53:54.000Z" itemprop="datePublished">2018-12-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/26/前端项目服务器常用工具/">前端项目服务器常用工具</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>nodejs 搭建服务器<br>假设我们要访问当前目录下的 index.html，可以写一个源生最简单的服务器：</p>
<p>let http = require(‘http’);<br>let url = require(‘url’);<br>let fs = require(‘fs’);</p>
<p>// 创建服务器<br>let server = http.createServer((req, res) =&gt; {<br>// 解析请求<br>let pathname = url.parse(req.url).pathname; // 形如<code>/index.html</code><br>console.log(‘收到对文件 ‘ + pathname + ‘的请求’);</p>
<p>// 读取文件内容<br>fs.readFile(pathname.substr(1), (err, data) =&gt; {<br>if (err) {<br>console.log(‘文件读取失败：’ + err);</p>
<pre><code>  // 设置404响应
  res.writeHead(404, { &apos;Content-Type&apos;: &apos;text/html&apos; });
  res.write(&apos;&lt;h1&gt;404&lt;/h1&gt;&apos;);
} else {
  // 状态码：200
  res.writeHead(200, { &apos;Content-Type&apos;: &apos;text/html&apos; });

  // 响应文件内容
  res.write(data.toString());
}

// 发送响应
res.end();
</code></pre><p>});<br>});</p>
<p>server.listen(8081);<br>console.log(‘服务运行在：<a href="http://localhost:8081，请访问：http://localhost:8081/index.html&#39;)" target="_blank" rel="noopener">http://localhost:8081，请访问：http://localhost:8081/index.html&#39;)</a>;</p>
<p>nodemon<br>当我们频繁修改 server.js 时，每次都要重新执行 node server.js 会很繁琐，这时我们可以用到 nodemon 工具，再修改 server.js 后，服务器会自动加载重启。</p>
<p>安装：npm install nodemon -g</p>
<p>使用： nodemon server.js</p>
<p>官方文档 <a href="https://nodemon.io/" target="_blank" rel="noopener">https://nodemon.io/</a></p>
<p>如果电脑有全局安装 npm 包限制，可以使用 npx 指令，例 npx nodemon server.js</p>
<p>http-server<br>平时开发时，我们有时只需要简单起个服务器查看前端项目 html 运行效果，这里可以用到 http-server。</p>
<p>安装：npm install http-server -g</p>
<p>使用：http-server -p [端口号(默认 8080)]</p>
<p>官方文档 <a href="https://github.com/indexzero/http-server" target="_blank" rel="noopener">https://github.com/indexzero/http-server</a></p>
<p>http-server 默认加载项目目录下的 index.html 或 /public/index.html 文件</p>
<p>PM2<br>PM2 是基于 nodejs 开发的后台进程管理工具。官方的说法，pm2 是一个带有负载均衡功能的 Node 应用的进程管理器。（其实 pm2 支持多种语言，只是对于除 node 之外的其他进程无负载均衡的能力）</p>
<p>安装: npm install pm2 -g 或 sudo npm install pm2@latest -g<br>官方文档 <a href="http://pm2.keymetrics.io/docs/usage/pm2-api/" target="_blank" rel="noopener">http://pm2.keymetrics.io/docs/usage/pm2-api/</a></p>
<p>一、PM2 特点<br>支持集群模式，支持负载均衡<br>支持监听重启，文件更新等情况下可实现进程自动重启<br>支持 linux 的 startup 进程启动（即开机自动启动）<br>日志管理，两种日志，pm2 系统日志与管理的进程日志<br>监控功能，pm2 monit 监控 cpu 和 memory 使用情况<br>支持 pm2 模块开发，提供 API 供开发者通过编程方式灵活管理进程<br>二、PM2 常用指令<br>指令 说明 示例<br>pm2 start [options] 启动指定应用 pm2 start index.js –name app_name<br>pm2 stop app_name 停止指定应用 pm2 stop app_name<br>pm2 restart app_name 重启指定应用 pm2 restart all<br>pm2 list 显示所有进程<br>pm2 show app_name 显示指定应用详情 pm2 show app_name<br>pm2 delete app_name 删除指定应用 pm2 delete 0<br>pm2 kill 杀掉 pm2 管理的所有进程<br>pm2 logs 查看指定应用的日志<br>pm2 monit 监控各个应用进程 cpu 和 memory 使用情况<br>pm2 describe app_name 查看某一个进程的信息，可以看到项目的日志目录等<br>app_name 也可以用 进程 id 代替，或者使用 all（全部）</p>
<p>三、常用配置 1.命令行使用配置<br>配置 说明<br>–watch 监听应用目录源码的变化，一旦发生变化，自动重启<br>-i | –instances 启用多少个实例，可用于负载均衡。如果-i 0 或-i max，则根据当前机器核数确定实例数目<br>–ignore-watch 排除监听的目录/文件，也可以用正则<br>-n | –name 定义应用的名称<br>-o | –output [path] 标准输出日志文件的路径，有默认路径<br>-e | –error [path] 错误输出日志文件的路径，有默认路径<br>例：pm2 start index.js –watch -i 2</p>
<p>2.使用配置文件<br>配置单个项目</p>
<p>{<br>“name”: “node-app”, // 应用进程名称<br>“script”: “bin/app.js”, // 当前目录启动脚本路径<br> “cwd”: “/srv/node-app/current”, // 电脑中应用启动的路径<br>“args”: [“–toto=heya coco”, “-d”, “1”], // 传递给脚本的参数<br>“node<em>args”: [“–harmony”, “ –max-stack-size=102400000”],<br>“log_date_format”: “YYYY-MM-DD HH:mm Z”, // 指定日志日期格式<br>“error_file”: “/var/log/node-app/node-app.stderr.log”, // 记录标准错误流，$HOME/.pm2/logs/XXXerr.log)，代码错误可在此文件查找<br>  “out_file”: “log/node-app.stdout.log”, // 记录标准输出流，$HOME/.pm2/logs/XXXout.log)，如应用打印大量的标准输出，会导致 pm2 日志过大<br>“instances”: 6, // 应用启动实例个数，仅在 cluster 模式有效，默认为 fork<br>“min_uptime”: “200s”, // 应用运行少于时间被认为是异常启动<br>“max_restarts”: 10, // 最大异常重启次数，即小于 min_uptime 运行时间重启次数<br>“max_memory_restart”: “1M”, // 最大内存限制数，超出自动重启<br>“cron_restart”: “1 0 \</em> * *“, // crontab 时间格式重启应用，目前只支持 cluster 模式<br>“watch”: false, // 监听重启，文件夹或子文件夹下变化应用自动重启<br>“ignore_watch”: [“[\/\\]\./“, “node_modules”], // 忽略监听的文件夹，支持正则表达式<br>“exec_mode”: “fork”, // 应用启动模式，支持 fork 和 cluster 模式<br>“autorestart”: false, // 默认为 true, 发生异常的情况下自动重启<br>“env”: { // 环境变量，object 类型<br>“NODE_ENV”: “production”,<br>“AWESOME_SERVICE_API_TOKEN”: “xxx”<br>},<br>“env<em>\</em>“: {<br>“SPECIFIC_ENV”: true<br>}<br>}<br>配置多个项目</p>
<p>{<br>“apps”: [<br>{<br>“name”: “worker-app-1”,<br>“script”: “worker.js”,<br>“args”: [“–toto=heya coco”, “-d”, “1”],<br>“watch”: true,<br>“node_args”: “–harmony”,<br>“merge_logs”: true,<br>“cwd”: “/this/is/a/path/to/start/script”,<br>“env”: {<br>“NODE_ENV”: “development”,<br>“AWESOME_SERVICE_API_TOKEN”: “xxx”<br>},<br>“env_production”: {<br>“NODE_ENV”: “production”<br>},<br>“env_staging”: {<br>“NODE_ENV”: “staging”,<br>“TEST”: true<br>}<br>},<br>{<br>“name”: “worker-app-2”,<br>“script”: “api.js”,<br>“instances”: 4,<br>“exec_mode”: “cluster_mode”,<br>“error_file”: “./examples/child-err.log”,<br>“out_file”: “./examples/child-out.log”,<br>“pid_file”: “./examples/child.pid”<br>}<br>]<br>}<br>四、开机自动启动</p>
<p>通过 pm2 save 保存当前进程状态。<br>通过 pm2 startup [platform]生成开机自启动的命令。例如：pm2 startup centeros<br>将步骤 2 生成的命令，粘贴到控制台进行</p>
<p>ngrok<br>使用 ngrok 可以把我们本地的项目映射到外网，使其他人可以访问本机指定端口的 web 项目。ngrok v1.0 版本是开源免费的，但是缺点是不太稳定。可以用于平时简单向外展示项目。</p>
<p>安装：官方网站下载 ngrok 工具</p>
<p>使用：将 ngrok 工具复制到项目目录下，执行./ngrok http [要映射的端口号]</p>
<p>ngrok 还可以自定义前缀，以及已经备案过的域名，详细可参考官方文档</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/12/26/前端项目服务器常用工具/" data-id="cjtvbojwy000ntqkqqwgk048l" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Node中使用Mongodb" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/30/Node中使用Mongodb/" class="article-date">
  <time datetime="2018-11-30T09:52:20.000Z" itemprop="datePublished">2018-11-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/30/Node中使用Mongodb/">Node中使用Mongodb</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li><p>Mongodb Driver(不做介绍)<br>npm install mongodb –save</p>
</li>
<li><p>mongoose<br>2.1 介绍<br>Mongoose 是在 node.js 异步环境下对 mongodb 进行便捷操作的对象模型工具。Mongoose 是 NodeJS 的驱动，不能作为其他语言的驱动。</p>
</li>
</ol>
<p>2.2 特点<br>通过关系型数据库的思想来设计非关系型数据库<br>基于 Mongodb 驱动，简化操作<br>2.3 使用步骤<br>安装 首先确保已经安装了 MongoDB 和 Node.js</p>
<p>npm install mongoose –save</p>
<p>引入 mongoose 并连接数据库</p>
<p>const mongoose = require(‘mongoose’);<br>// 连接到本地 test 数据库<br>// useNewUrlParser 这个属性会在 url 中识别验证用户所需的 db,未升级前不需要指定<br>mongoose.connect(‘mongodb://localhost:27017/test’, { useNewUrlParser: true });</p>
<p>// 如果有账户密码需要采用下面的连接方式:<br>// mongoose.connect(‘mongodb://用户名:密码@localhost:27017/test’);<br>判断是否连接成功并监听 error</p>
<p>定义 Schema 数据库中的 Schema 即为数据库对象的集合。schema 是 mongoose 里用到的一种数据模式，可以理解为表结构的定义。每个 schema 会映射到 mongodb 中的一个 collection，它不具备操作数据库的能力。</p>
<p>// Schema 里面的对象要和数据库集合里面的字段一一对应<br>const UserSchema = new mongoose.Schema({<br>name: String,<br>age: Number,<br>status: Number,<br>});<br>创建数据模型 model 是由 schema 生成的模型，可以对数据库的操作。 Note: mongoose.model(模型名称(首字母大写), Schema, [集合名称]) 如果没有传入第三个参数，则 Mongoose 会自动查找以模型名称的复数形式命名的集合，否则该模型将与第三个参数定义的名称的集合建立连接。<br>The first argument is the singular name of the collection your model is for. Mongoose automatically looks for the plural version of your model name.</p>
<p>// 模型将会操作 users 这个集合<br>const User = mongoose.model(‘User’, UserSchema);<br>查询集合数据</p>
<p>User.find({}, (err, docs) =&gt; {<br>if (err) {<br>console.log(err);<br>return;<br>}<br>console.log(docs);<br>})<br>增加数据</p>
<p>// 实例化 Model, 通过实例化 User Model 创建增加的数据<br>const user = new User({<br>name: ‘Graceji’,<br>age: 18,<br>status: 1,<br>});</p>
<p>// 执行增加操作<br>user.save((err, user) =&gt; {<br>if (err) {<br>console.log(err);<br>return;<br>}<br>console.log(user.name);<br>});<br>更新数据<br>// 将 name 字段值为’Graceji’的文档的 age 字段值设置为 28<br>User.updateOne({ name: ‘Graceji’ }, { age: 28 }, (err, doc) =&gt; {<br>if (err) {<br>console.log(err);<br>return;<br>}<br>console.log(doc);<br>});<br>删除数据<br>// 删除 name 字段值为’Graceji’的文档<br>User.deleteOne({ name: ‘Graceji’ }, (err, result) =&gt; {<br>if (err) {<br>console.log(err);<br>return;<br>}<br>console.log(result);<br>});</p>
<ol start="3">
<li>Schema<br>3.1 Schema 数据类型（ SchemaTypes）<br>mongoose 中支持的合法的 SchemaTypes 如下：</li>
</ol>
<p>String<br>Number<br>Date<br>Buffer<br>Boolean<br>Mixed<br>ObjectId<br>Array<br>Decimal128<br>Map 例如:<br>const mongoose = require(‘mongoose’);<br>const Schema = mongoose.Schema;<br>const schema = new Schema({<br>name: String,<br>binary: Buffer,<br>living: Boolean,<br>updated: { type: Date, default: Date.now },<br>age: { type: Number, min: 18, max: 65 },<br>mixed: Schema.Types.Mixed,<br>_someId: Schema.Types.ObjectId,<br>decimal: Schema.Types.Decimal128,<br>array: [],<br>ofString: [String],<br>ofNumber: [Number],<br>ofDates: [Date],<br>ofBuffer: [Buffer],<br>ofBoolean: [Boolean],<br>ofMixed: [Schema.Types.Mixed],<br>ofObjectId: [Schema.Types.ObjectId],<br>ofArrays: [[]],<br>ofArrayOfNumbers: [[Number]],<br>nested: {<br>stuff: { type: String, lowercase: true, trim: true }<br>},<br>map: Map,<br>mapOfString: {<br>type: Map,<br>of: String<br>}<br>})</p>
<p>// example use</p>
<p>const Thing = mongoose.model(‘Thing’, schema);</p>
<p>const m = new Thing;<br>m.name = ‘Statue of Liberty’;<br>m.age = 125;<br>m.updated = new Date;<br>m.binary = Buffer.alloc(0);<br>m.living = false;<br>m.mixed = { any: { thing: ‘i want’ } };<br>/_<br>Since Mixed is a schema-less type, you can change the value to anything else you like, but Mongoose loses the ability to auto detect and save those changes. To “tell” Mongoose that the value of a Mixed type has changed, call the .markModified(path)<br>_/<br>m.markModified(‘mixed’);<br>m._someId = new mongoose.Types.ObjectId;<br>m.array.push(1);<br>m.ofString.push(“strings!”);<br>m.ofNumber.unshift(1,2,3,4);<br>m.ofDates.addToSet(new Date);<br>m.ofBuffer.pop();<br>m.ofMixed = [1, [], ‘three’, { four: 5 }];<br>m.nested.stuff = ‘good’;<br>m.map = new Map([[‘key’, ‘value’]]);<br>m.save(callback);<br>3.2 SchemaType Options<br>可以直接使用以上数据类型来定义一个 schema type，也可以使用有 type 属性的对象来定义。 例如：</p>
<p>const schema1 = new Schema({<br>test: String // <code>test</code> 为 String 类型<br>});</p>
<p>const schema2 = new Schema({<br>test: { type: String } // <code>test</code> 为 String 类型<br>});<br>除了 type 属性，也可以指定其它属性。 例如：</p>
<p>const schema2 = new Schema({<br>test: {<br>type: String,<br>lowercase: true // 将<code>test</code> 转变为小写<br>}<br>});<br>3.2.1 适用于所有 Schema Types 的 option<br>required: boolean or function，如果为 true，则为该属性添加了一个 required validator<br>default: Any or function，设置属性默认值。如果为函数，则函数的返回值为默认值。<br>select: boolean，specifies default projections for queries<br>validate: function, 为属性添加一个 validator function<br>get: function，使用 Object.defineProperty()为属性自定义一个 getter<br>set: function，使用 Object.defineProperty()为属性自定义一个 setter<br>alias: string, 只适用于 mongoose &gt;= 4.10.0 的版本中. Defines a virtual with the given name that gets/sets this path. 以 set 为例说明：<br>const mongoose = require(‘mongoose’);</p>
<p>mongoose.connect(‘mongodb://localhost:27017/test’, { useNewUrlParser: true });</p>
<p>const focusSchema = new mongoose.Schema({<br>title: {<br>type: String,<br>trim: true,<br>},<br>pic: {<br>type: String,<br>get: val =&gt; <code>图片地址为${val}</code>,<br>},<br>redirect: {<br>type: String,<br>// 保存数据时对 redirect 字段进行处理<br>set: val =&gt; {<br>// val 为 redirect 字段的值<br>// 该函数的返回值即为 redirect 字段在数据库中实际保存的值<br>const reg = /^(http|https).*/<br>if (!val) return ‘’;<br>if (!reg.test(val)) {<br>return <code>http://${val}</code>;<br>}<br>return val;<br>}<br>},<br>status: {<br>type: Number,<br>default: 1,<br>},<br>});</p>
<p>const FocusModel = mongoose.model(‘Focus’, focusSchema);</p>
<p>const focus = new FocusModel({<br>title: ‘focus’,<br>pic: ‘<a href="http://www.xxx.com/x.png&#39;" target="_blank" rel="noopener">www.xxx.com/x.png&#39;</a>,<br>redirect: ‘<a href="http://www.baidu.com&#39;" target="_blank" rel="noopener">www.baidu.com&#39;</a>,<br>});</p>
<p>focus.save((err) =&gt; {<br>if (err) {<br>console.log(err);<br>return;<br>}<br>FocusModel.find({}, (err, docs) =&gt; {<br>if (err) {<br>console.log(err);<br>return;<br>}<br>// [{<br>// status: 1,<br>// _id: 5badd934ee8e6bbf89d2bb62,<br>// title: ‘focus’,<br>// pic: ‘<a href="http://www.xxx.com/x.png&#39;" target="_blank" rel="noopener">www.xxx.com/x.png&#39;</a>,<br>// redirect: ‘<a href="http://www.baidu.com&#39;" target="_blank" rel="noopener">http://www.baidu.com&#39;</a>,<br>// __v: 0<br>// }]<br>console.log(docs);<br>console.log(focus.pic); // 图片地址为 <a href="http://www.xxx.com/x.png" target="_blank" rel="noopener">www.xxx.com/x.png</a><br>});<br>});<br>Note:</p>
<p>set 修饰符是在保存数据时对数据进行格式化，最终保存到数据库中的值为 set 函数的返回值<br>get 修饰符是在实例获取数据的时候对数据格式化，不会影响保存到数据库中的值<br>3.2.2 定义索引的 option<br>可以使用 schema type options 来定义 MongoDB indexes</p>
<p>index: boolean，是否在该属性上定义 index<br>unique: boolean，是否在该属性上定义 unique index<br>sparse: boolean，是否在该属性上定义 sparse index<br>3.2.3 适用于 String 类型的 option<br>lowercase: boolean，是否对属性值调用.toLowerCase()<br>uppercase: boolean，是否对属性值调用.toUpperCase()<br>trim: boolean，是否对属性值调用.trim()<br>match: RegExp，创建了一个 validator 来检查属性值是否匹配正则<br>enum: Array，创建了一个 validator 来检查属性值是否在给定的数组中<br>minlength: Number，创建了一个 validator 来检查属性值的长度是否大于等于给定值<br>maxlength: Number，创建了一个 validator 来检查属性值的长度是否小于等于给定值<br>3.2.4 适用于 Number 类型的 option<br>min: Number，创建了一个 validator 来检查属性值是否大于等于给定值<br>max: Number，创建了一个 validator 来检查属性值是否小于等于给定值<br>3.2.5 适用于 Date 类型的 option<br>min: Date<br>max: Date<br>3.2.6 自定义校验器<br>Mongoose 有很多内置数据校验器：</p>
<p>所有 SchemaTypes 都有内置的 required 校验器<br>Numbers 类型有 min and max 校验器<br>String 类型有 enum, match, maxlength and minlength 校验器 当内置校验器不能够满足要求时可以通过 SchemaType#validate()自定义校验器。 例如：<br>const userSchema = new mongoose.Schema({<br>name: {<br>type: String,<br>get: v =&gt; {<br>return <code>aoo1${v}</code>;<br>}<br>},<br>age: Number,<br>status: Number,<br>sn: {<br>type: String,<br>match: /^sn(.*)/,<br>validate: {<br>validator: (v) =&gt; (v.length &gt; 10),<br>message: props =&gt; <code>${props.value} 长度不符合要求</code><br>},<br>// 也可直接指定函数<br>// validate: (sn) =&gt; (sn.length &gt; 10),<br>}<br>});<br>若这样添加文档数据</p>
<p>const user = new UserModel({<br>name: ‘Graceji’,<br>age: 18,<br>status: 1,<br>sn: ‘sn123’<br>});<br>则报错：</p>
<p>3.3 Schemas<br>Schemas 不仅可以定义文档的结构以及属性的类型，它也可以扩展文档的实例方法以和 Model 的静态方法，定义索引，以及文档生命周期钩子([middleware]。</p>
<p>3.3.1 扩展 Mongoose Model 的实例方法<br>Models 的实例即为 documents。Documents 有许多内置方法，也可以通过 Schema 来扩展 Model 的实例方法。</p>
<p>// define a schema<br>const animalSchema = new Schema({ name: String, type: String });</p>
<p>// 使用 Schema.methods 对象来保存实例方法<br>animalSchema.methods.findSimilarTypes = function(cb) {<br>// this 指向 document<br>return this.model(‘Animal’).find({ type: this.type }, cb);<br>};<br>现在 Animal model 的实例都会有一个 findSimilarTypes 方法。</p>
<p>const Animal = mongoose.model(‘Animal’, animalSchema);<br>const dog = new Animal({ type: ‘dog’ });</p>
<p>dog.findSimilarTypes(function(err, dogs) {<br>console.log(dogs);<br>});<br>3.3.2 扩展 Mongoose Model 的静态方法<br>依然使用 animalSchema 为例，为 Model 添加静态方法</p>
<p>// assign a function to the “statics” object of our animalSchema<br>animalSchema.statics.findByName = function(name, cb) {<br>// this 指向当前的 Model<br>return this.find({ name: new RegExp(name, ‘i’) }, cb);<br>};</p>
<p>const Animal = mongoose.model(‘Animal’, animalSchema);<br>Animal.findByName(‘fido’, (err, animals) =&gt; {<br>console.log(animals);<br>});<br>Model 扩展实例方法时，不要使用箭头函数(=&gt;)。因为箭头函数会阻止 this 的绑定。</p>
<ol start="4">
<li>Mongoose 内置 CURD 方法<br>Deleting：</li>
</ol>
<p>Model.deleteMany()<br>Model.deleteOne()<br>Querying：</p>
<p>Model.find()<br>Model.findById()<br>Model.findByIdAndDelete()<br>Model.findByIdAndRemove()<br>Model.findByIdAndUpdate()<br>Model.findOne()<br>Model.findOneAndDelete()<br>Model.findOneAndRemove()<br>Model.findOneAndUpdate()<br>Updating：</p>
<p>Model.replaceOne()<br>Model.updateMany()<br>Model.updateOne()</p>
<ol start="5">
<li>Mongoose 聚合管道(Aggregate)<br>方法：Model.aggregate( [pipeline], [callback] )</li>
</ol>
<p>[pipeline] «Array» aggregation pipeline as an array of objects<br>[callback] «Function»<br>Examples: order.js</p>
<p>const Schema = mongoose.Schema;</p>
<p>const orderSchema = new Schema({<br>order_id: String,<br>uid: Number,<br>trade_no: String,<br>all_price: Number,<br>all_num: Number<br>});</p>
<p>const orders = [{<br>order_id: ‘1’,<br>uid: 10,<br>trade_no:’111’,<br>all_price: 100,<br>all_num: 2,<br>}, {<br>order_id: ‘2’,<br>uid: 7,<br>trade_no: ‘222’,<br>all_price: 90,<br>all_num: 2,<br>}, {<br>order_id: ‘3’,<br>uid: 9,<br>trade_no: ‘333’,<br>all_price: 20,<br>all_num: 6,<br>}];</p>
<p>const OrderModel = mongoose.model(‘Order’, orderSchema, ‘order’);</p>
<p>OrderModel.insertMany(orders, (error, docs) =&gt; {<br>if (error) return;<br>console.log(‘插入文档成功’);<br>console.log(docs);<br>});<br>orderItem.js</p>
<p>const Schema = mongoose.Schema;</p>
<p>const orderItemSchema = new Schema({<br>order_id: String,<br>title: String,<br>price: Number,<br>num: Number,<br>});</p>
<p>const orderItems = [{<br>order_id: ‘1’, title: ‘商品鼠标 1’, price: 50, num: 1<br>}, {<br>order_id: ‘1’, title: ‘商品键盘 2’, price: 50, num: 1<br>}, {<br>order_id: ‘1’, title: ‘商品键盘 3’, price: 0, num: 1<br>}, {<br>order_id: ‘2’, title: ‘牛奶’, price: 50, num: 1,<br>}, {<br>order_id: ‘2’, title: ‘酸奶’, price: 40, num: 1<br>}, {<br>order_id: ‘3’, title: ‘矿泉水’, price: 2, num: 5<br>}, {<br>order_id: ‘3’, title: ‘毛巾’, price: 10, num: 1<br>}];</p>
<p>const OrderItemModel = mongoose.model(‘OrderItem’, orderItemSchema, ‘order_item’);</p>
<p>OrderItemModel.insertMany(orderItems, (error, docs) =&gt; {<br>if (error) return;<br>console.log(‘插入文档成功’);<br>console.log(docs);<br>});<br>运行以上代码就能插入两张表，分别为 order 和 order_item。</p>
<p>order 表结构</p>
<p>order_item 表结构</p>
<p>两个表关联查询<br>情景一：查询订单，并找到每个订单下对应的所有商品。<br>app.js</p>
<p>const OrderModel = require(‘./order’);</p>
<p>// 第一种写法<br>OrderModel.aggregate([<br>{<br>$lookup: {<br>from: ‘order_item’,<br>localField: ‘order_id’,<br>foreignField: ‘order_id’,<br>as: ‘items’,<br>}<br>}<br>], (err, docs) =&gt; {<br>if (err) return;<br>console.log(JSON.stringify(docs));<br>});</p>
<p>// 第二种写法<br>OrderModel.aggregate([<br>{<br>$lookup: {<br>from: ‘order_item’,<br>localField: ‘order_id’,<br>foreignField: ‘order_id’,<br>as: ‘items’,<br>}<br>}<br>])<br>.then(function (res) {<br>console.log(JSON.stringify(res));<br>});</p>
<p>// 第三种写法<br>OrderModel<br>.aggregate()<br>.lookup({<br>from: ‘order_item’,<br>localField: ‘order_id’,<br>foreignField: ‘order_id’,<br>as: ‘items’,<br>})<br>.exec(function (err, res) {<br>if (err) return handleError(err);<br>console.log(JSON.stringify(res));<br>});<br>运行结果：</p>
<p>[{<br>“_id”: “5baf15e985d168faa49a28b7”,<br>“order_id”: “1”,<br>“uid”: 10,<br>“trade_no”: “111”,<br>“all_price”: 100,<br>“all_num”: 2,<br>“<strong>v”: 0,<br>“items”: [{<br>“_id”: “5baf172e609251fb2b5798f7”,<br>“order_id”: “1”,<br>“title”: “商品鼠标 1”,<br>“price”: 50,<br>“num”: 1,<br>“</strong>v”: 0<br>}, {<br>“_id”: “5baf172e609251fb2b5798f8”,<br>“order_id”: “1”,<br>“title”: “商品键盘 2”,<br>“price”: 50,<br>“num”: 1,<br>“<strong>v”: 0<br>}, {<br>“_id”: “5baf172e609251fb2b5798f9”,<br>“order_id”: “1”,<br>“title”: “商品键盘 3”,<br>“price”: 0,<br>“num”: 1,<br>“</strong>v”: 0<br>}]<br>}, {<br>“_id”: “5baf15e985d168faa49a28b8”,<br>“order_id”: “2”,<br>“uid”: 7,<br>“trade_no”: “222”,<br>“all_price”: 90,<br>“all_num”: 2,<br>“<strong>v”: 0,<br>“items”: [{<br>“_id”: “5baf172e609251fb2b5798fa”,<br>“order_id”: “2”,<br>“title”: “牛奶”,<br>“price”: 50,<br>“num”: 1,<br>“</strong>v”: 0<br>}, {<br>“_id”: “5baf172e609251fb2b5798fb”,<br>“order_id”: “2”,<br>“title”: “酸奶”,<br>“price”: 40,<br>“num”: 1,<br>“<strong>v”: 0<br>}]<br>}, {<br>“_id”: “5baf15e985d168faa49a28b9”,<br>“order_id”: “3”,<br>“uid”: 9,<br>“trade_no”: “333”,<br>“all_price”: 20,<br>“all_num”: 6,<br>“</strong>v”: 0,<br>“items”: [{<br>“_id”: “5baf172e609251fb2b5798fc”,<br>“order_id”: “3”,<br>“title”: “矿泉水”,<br>“price”: 2,<br>“num”: 5,<br>“<strong>v”: 0<br>}, {<br>“_id”: “5baf172e609251fb2b5798fd”,<br>“order_id”: “3”,<br>“title”: “毛巾”,<br>“price”: 10,<br>“num”: 1,<br>“</strong>v”: 0<br>}]<br>}]<br>情景二：查询 order_item，找出商品名称是酸奶的商品，并找出该商品对应的订单号以及订单的总价格。</p>
<p>app.js</p>
<p>const OrderItemModel = require(‘./orderItem’);</p>
<p>OrderItemModel<br>.aggregate()<br>.match({<br>‘title’: ‘酸奶’,<br>})<br>.lookup({<br>from: ‘order’,<br>localField: ‘order_id’,<br>foreignField: ‘order_id’,<br>as: ‘order_info’,<br>})<br>.exec(function (err, res) {<br>if (err) return handleError(err);<br>console.log(JSON.stringify(res));<br>});<br>运行结果：</p>
<p>[{<br>“_id”: “5baf172e609251fb2b5798fb”,<br>“order_id”: “2”,<br>“title”: “酸奶”,<br>“price”: 40,<br>“num”: 1,<br>“<strong>v”: 0,<br>“order_info”: [{<br>“_id”: “5baf15e985d168faa49a28b8”,<br>“order_id”: “2”,<br>“uid”: 7,<br>“trade_no”: “222”,<br>“all_price”: 90,<br>“all_num”: 2,<br>“</strong>v”: 0<br>}]<br>}]<br>多个表关联查询<br>Examples: user.js</p>
<p>const Schema = mongoose.Schema;</p>
<p>const userSchema = new Schema({<br>username: String,<br>password: String,<br>age: Number,<br>sex: String,<br>tel: Number,<br>});</p>
<p>const UserModel = mongoose.model(‘User’, userSchema, ‘user’);</p>
<p>module.exports = UserModel;<br>article.js</p>
<p>const Schema = mongoose.Schema;</p>
<p>const articleSchema = new Schema({<br>title: {<br>type: String,<br>unique: true,<br>},<br>cid: Schema.Types.ObjectId,<br>author_name: {<br>type: String,<br>default: ‘Graceji’,<br>},<br>author_id: Schema.Types.ObjectId,<br>description: String,<br>add_time: Date,<br>content: String,<br>});</p>
<p>const ArticleModel = mongoose.model(‘Article’, articleSchema, ‘article’);</p>
<p>module.exports = ArticleModel;<br>articleCate.js</p>
<p>const Schema = mongoose.Schema;</p>
<p>const articleCateSchema = new Schema({<br>title: {<br>type: String,<br>unique: true,<br>},<br>description: String,<br>});</p>
<p>const ArticleCateModel = mongoose.model(‘ArticleCate’, articleCateSchema, ‘article_cate’);</p>
<p>module.exports = ArticleCateModel;<br>插入数据的过程省略。 情景一：查询文章信息，并显示文章的分类以及作者信息 app.js</p>
<p>const ArticleModel = require(‘./article’);</p>
<p>ArticleModel<br>.aggregate()<br>.lookup({<br>from: ‘article_cate’,<br>localField: ‘cid’,<br>foreignField: ‘_id’,<br>as: ‘category_info’,<br>})<br>.lookup({<br>from: ‘user’,<br>localField: ‘author_id’,<br>foreignField: ‘_id’,<br>as: ‘user_info’,<br>})<br>.exec(function (err, res) {<br>if (err) return handleError(err);<br>console.log(JSON.stringify(res));<br>});<br>运行结果</p>
<p>[{<br>“_id”: “5baf316a271fd1017037d4e2”,<br>“author_name”: “Graceji1”,<br>“title”: “我是一条国际新闻 1”,<br>“cid”: “5baf2debab859800f81fa96b”,<br>“author_id”: “5baf2e292397450118c35d16”,<br>“description”: “我是一条国际新闻的内容 1”,<br>“add_time”: “2018-09-29T08:01:46.655Z”,<br>“content”: “啦啦啦啦啦啦 1”,<br>“<strong>v”: 0,<br>“category_info”: [{<br>“_id”: “5baf2debab859800f81fa96b”,<br>“title”: “国际新闻”,<br>“description”: “这是国际新闻”,<br>“</strong>v”: 0<br>}],<br>“user_info”: [{<br>“_id”: “5baf2e292397450118c35d16”,<br>“username”: “Graceji1”,<br>“password”: “123”,<br>“age”: 18,<br>“sex”: “女”,<br>“tel”: 18717716965,<br>“<strong>v”: 0<br>}]<br>}, {<br>“_id”: “5baf316a271fd1017037d4e3”,<br>“author_name”: “Graceji2”,<br>“title”: “我是一条国际新闻 2”,<br>“cid”: “5baf2debab859800f81fa96b”,<br>“author_id”: “5baf2e292397450118c35d17”,<br>“description”: “我是一条国际新闻的内容 2”,<br>“add_time”: “2018-09-29T08:01:46.655Z”,<br>“content”: “啦啦啦啦啦啦 2”,<br>“<strong>v”: 0,<br>“category_info”: [{<br>“_id”: “5baf2debab859800f81fa96b”,<br>“title”: “国际新闻”,<br>“description”: “这是国际新闻”,<br>“</strong>v”: 0<br>}],<br>“user_info”: [{<br>“_id”: “5baf2e292397450118c35d17”,<br>“username”: “Graceji2”,<br>“password”: “123”,<br>“age”: 28,<br>“sex”: “女”,<br>“tel”: 18717716966,<br>“</strong>v”: 0<br>}]<br>}, {<br>“_id”: “5baf316a271fd1017037d4e4”,<br>“author_name”: “Graceji5”,<br>“title”: “我是一条国内新闻”,<br>“cid”: “5baf2debab859800f81fa96c”,<br>“author_id”: “5baf2e292397450118c35d1a”,<br>“description”: “我是一条国内新闻的内容”,<br>“add_time”: “2018-09-29T08:01:46.655Z”,<br>“content”: “啦啦啦啦啦啦”,<br>“<strong>v”: 0,<br>“category_info”: [{<br>“_id”: “5baf2debab859800f81fa96c”,<br>“title”: “国内新闻”,<br>“description”: “这是国内新闻”,<br>“</strong>v”: 0<br>}],<br>“user_info”: [{<br>“_id”: “5baf2e292397450118c35d1a”,<br>“username”: “Graceji5”,<br>“password”: “123”,<br>“age”: 38,<br>“sex”: “女”,<br>“tel”: 18717716965,<br>“__v”: 0<br>}]<br>}]</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/11/30/Node中使用Mongodb/" data-id="cjtvbojwi0004tqkqfa9wlu4n" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-webpack配置-多页应用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/22/webpack配置-多页应用/" class="article-date">
  <time datetime="2018-07-22T09:51:18.000Z" itemprop="datePublished">2018-07-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/22/webpack配置-多页应用/">webpack配置-多页应用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>一、文件结构<br>build<br>├── build.js<br>├── check-versions.js<br>├── utils.js<br>├── webpack.base.conf.js<br>├── webpack.dev.conf.js<br>├── webpack.prod.conf.js<br>└── webpack_dll.config.js<br>config<br>└── index.js<br>public<br>└── static<br>├── iconfont<br>│ ├── iconfont.css<br>│ ├── iconfont.eot<br>│ ├── iconfont.js<br>│ ├── iconfont.svg<br>│ ├── iconfont.ttf<br>│ └── iconfont.woff<br>└── vendor<br>├── vendor.dll.js<br>└── vendor.manifest.json</p>
<p>3 directories, 16 files<br>二、具体配置<br>2.1 webpack.base.config<br>2.1.1 入口<br>entry: {<br>home: ‘./src/home’,<br>page2: ‘./src/page2’,<br>},<br>由于本项目为多页应用，固配置入口时有多个入口起点。写法为 key: value 形式，最后会生成多个 chunk，每个 chunk 的名称为 object 键值对中 key 的名称。</p>
<p>2.1.2 输出<br>output: {<br>path: config.build.assetsRoot,<br>filename: ‘[name].js’,<br>publicPath: process.env.NODE_ENV === ‘production’<br>? config.build.assetsPublicPath<br>: config.dev.assetsPublicPath,<br>},<br>所有静态文件会输出到 dist 文件夹下。</p>
<p>2.1.3 Resolve<br>resolve: {<br>extensions: [‘.js’, ‘.json’, ‘.jsx’, ‘.less’]<br>},<br>resolve 配置寻找模块的规则。</p>
<p>2.1.4 loader<br>test: /.(js|jsx)\$/,<br>loader: ‘eslint-loader’,<br>enforce: ‘pre’, // 前置 loader,会优先执行<br>include: [resolve(‘src’)], // 对 src 文件夹下的代码进行 eslint 规则验证<br>options: {<br>formatter: require(‘eslint-friendly-formatter’),<br>emitWarning: !config.dev.showEslintErrorsInOverlay<br>}<br>2.1.5 动态链接库(结合 2.2)<br>plugins: [<br>new webpack.DllReferencePlugin({<br>manifest: require(‘../public/static/vendor/vendor.manifest.json’),<br>}),<br>],<br>2.2 webpack_dll.config<br>const vendor = [<br>‘react’,<br>‘react-dom’,<br>‘prop-types’,<br>‘react-router’,<br>‘react-helmet’,<br>‘mobx’,<br>‘mobx-react’,<br>‘antd’,<br>‘axios’,<br>];</p>
<p>const dllConfig = {<br>mode: ‘none’,<br>entry: {<br>vendor,<br>},<br>output: {<br>filename: ‘[name].dll.js’,<br>path: path.resolve(<strong>dirname, ‘../public/static’, ‘vendor’),<br>library: ‘<em>dll</em>[name]’,<br>publicPath: ‘/dist/‘,<br>},<br>plugins: [<br>new webpack.DllPlugin({<br>name: ‘<em>dll</em>[name]’,<br>path: path.join(</strong>dirname, ‘../public/static’, ‘vendor/[name].manifest.json’),<br>}),<br>],<br>}</p>
<p>module.exports = (env, argv) =&gt; {<br>if (argv.mode === ‘production’) {<br>dllConfig.plugins.push(<br>new UglifyJsPlugin({<br>uglifyOptions: {<br>compress: {<br>warnings: false<br>},<br>output: {<br>comments: false,<br>beautify: false,<br>},<br>},<br>sourceMap: false,<br>parallel: true<br>})<br>);<br>}</p>
<p>return dllConfig;<br>};<br>将’react’、 ‘react-dom’、’prop-types’、’react-router’、’react-helmet’、’mobx’、’mobx-react’、’antd’、’axios’这些基础依赖模块抽离出来，打包到一个单独的.dll 文件中，当需要导入以上模块时，会直接去动态链接库中获取，不会再次打包。<br>DllPlugin 插件：用于打包动态链接库文件。<br>DllReferencePlugin 插件：用于在主配置文件中引入 DllPlugin 插件打包好的.dll 文件。(见 2.1.5)<br>文件最后返回一个函数是为了区分环境，生产环境中使用的.dll 文件需要压缩。<br>2.2 开发环境<br>2.2.1 mode<br>module.exports = {</p>
<ul>
<li>mode: ‘development’</li>
</ul>
<ul>
<li>devtool: ‘eval’,</li>
<li>plugins: [</li>
<li>new webpack.NamedModulesPlugin(),</li>
<li>new webpack.NamedChunksPlugin(),</li>
<li>new webpack.DefinePlugin({ “process.env.NODE_ENV”: JSON.stringify(“development”) }),</li>
<li><p>]<br>}<br>设置 mode 值为 development 后，可以去掉 NamedModulesPlugin、NamedChunksPlugin 以及 DefinePlugin 插件，为其默认行为。</p>
<p>2.2.2 DevServer 配置注意点<br>由于有多个入口所以 historyApiFallback 的配置也需要配置多个<br>historyApiFallback: {<br>rewrites: [<br>{ from: /^\/home.html/, to: path.posix.join(config.dev.assetsPublicPath, ‘home.html’) },<br>{ from: /^\/page2.html/, to: path.posix.join(config.dev.assetsPublicPath, ‘page2.html’) },<br>{ from: /.*/, to: path.posix.join(config.dev.assetsPublicPath, ‘home.html’) },<br>],<br>},<br>要访问额外的静态资源就需要配置 contentBase, 不然找不到文件<br>contentBase: path.resolve(__dirname, ‘../public’),<br>有多少个入口，就需要配置多少个 HtmlWebpackPlugin 实例。<br>new HtmlWebpackPlugin({<br>filename: ‘home.html’,<br>template: ‘./template.html’,<br>chunks: [‘home’],<br>inject: true,<br>vendor: ‘/static/vendor/vendor.dll.js’,<br>}),<br>new HtmlWebpackPlugin({<br>filename: ‘page2.html’,<br>template: ‘./template.html’,<br>chunks: [‘page2’],<br>inject: true,<br>vendor: ‘/static/vendor/vendor.dll.js’,<br>}),<br>在模板文件中插入.dll 文件的方式为</p>
<script src="<%= htmlWebpackPlugin.options.vendor %>"></script>

<p>2.3 生产环境<br>2.3.1 mode<br>与开发环境类似，设置 mode 为 production，只是默认行为有所区别。</p>
</li>
</ul>
<p>Sets process.env.NODE_ENV on DefinePlugin to value production. Enables FlagDependencyUsagePlugin, FlagIncludedChunksPlugin, ModuleConcatenationPlugin, NoEmitOnErrorsPlugin, OccurrenceOrderPlugin, SideEffectsFlagPlugin and UglifyJsPlugin.</p>
<p>2.3.2 抽取公共包<br>webpack4 中不再推荐使用 CommonsChunkPlugin，抽取公共包可以通过设置 optimization 对象中的 splitChunks。</p>
<p>optimization: {<br>runtimeChunk: {<br>name: ‘manifest’<br>},<br>splitChunks: {<br>chunks: ‘all’, // initial、async 和 all<br>minSize: 30000, // 形成一个新代码块最小的体积<br>minChunks: 1, // 在分割之前，这个代码块最小应该被引用的次数<br>maxAsyncRequests: 5, // 按需加载时候最大的并行请求数<br>maxInitialRequests: 3, // 最大初始化请求数<br>automaticNameDelimiter: ‘~’, // 打包分割符<br>name: ‘commons’,<br>// 打包后的名字<br>cacheGroups: {<br>vendors: {<br>test: /[\/]node_modules[\/]/, //用于控制哪些模块被这个缓存组匹配到、它默认会选择所有的模块<br>priority: -10, //缓存组打包的先后优先级<br>name: ‘vendors’,<br>minSize: 3000<br>},<br>default: {<br>minChunks: 2,<br>priority: -20,<br>minSize: 3000<br>}<br>}<br>},<br>},<br>2.3.3 抽离样式文件<br>webpack4 不再推荐使用 extract-text-webpack-plugin 提取文件，推荐使用 mini-css-extract-plugin。</p>
<pre><code>new MiniCssExtractPlugin({
  filename: utils.assetsPath(&apos;css/[name].[contenthash:12].css&apos;),
  allChunks: true,
}),
</code></pre><p>2.3.4 HtmlWebpackPlugin 配置<br>HtmlWebpackPlugin 的配置与开发环境中类似，只是多了压缩部分</p>
<p>minify: {<br>removeComments: true,<br>collapseWhitespace: true,<br>removeAttributeQuotes: true<br>},<br>2.3.5 不需要 webpack 处理的静态文件<br>我将不需要 webpack 处理的静态文件都放在了 public 文件夹中，例如：字体文件等。这部分文件在打包时只需直接复制到 dist 文件夹中即可</p>
<pre><code>new CopyWebpackPlugin([
  {
    from: path.resolve(__dirname, &apos;../public/static&apos;),
    to: config.build.assetsSubDirectory,
    ignore: [&apos;.*&apos;]
  }
])
</code></pre><p>总结<br>由于组织语言能力有限，有写的不明白的可以直接来问我。以上只是对各个配置文件做了简单的介绍，整体风格与 VUE-CLI 一致，个人认为这种书写方式更为清晰易懂，有熟悉 create-react-app 的小伙伴也可以结合两者，做出更好的配置。webpack 还有很多优化的地方，目前我只是加入了动态链接库的配置，接下来我会加入其它的优化点，敬请期待。。。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/07/22/webpack配置-多页应用/" data-id="cjtvbojwv000itqkqex1v5082" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-利用Access-Control-Allow-Origin响应头解决跨域请求原理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/06/25/利用Access-Control-Allow-Origin响应头解决跨域请求原理/" class="article-date">
  <time datetime="2018-06-25T07:26:58.000Z" itemprop="datePublished">2018-06-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/06/25/利用Access-Control-Allow-Origin响应头解决跨域请求原理/">利用Access-Control-Allow-Origin响应头解决跨域请求原理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>W3C 提供了跨域请求的标准方案（Cross-Origin Resource Sharing）。<br>IE8、Firefox 3.5 及其以后的版本、Chrome 浏览器、Safari 4 等已经实现了 Cross-Origin Resource Sharing 规范，实现了跨域请求。<br>在服务器响应客户端的时候，带上 Access-Control-Allow-Origin 头信息。</p>
<p>如果设置 Access-Control-Allow-Origin:*，则允许所有域名的脚本访问该资源。<br>Access-Control-Allow-Origin:<a href="http://www.phpddt.com.com,允许特定的域名访问。" target="_blank" rel="noopener">http://www.phpddt.com.com,允许特定的域名访问。</a></p>
<h2 id="Cross-Origin-Resource-Sharing-协议介绍"><a href="#Cross-Origin-Resource-Sharing-协议介绍" class="headerlink" title="Cross-Origin Resource Sharing 协议介绍"></a>Cross-Origin Resource Sharing 协议介绍</h2><p>传统的 Ajax 请求只能获取在同一个域名下面的资源，但是 HTML5 打破了这个限制，允许 Ajax 发起跨域的请求。<br>浏览器是可以发起跨域请求的，比如你可以外链一个外域的图片或者脚本。但是 Javascript 脚本是不能获取这些资源的内容的，它只能被浏览器执行或渲染。</p>
<p>Javascript 先发出跨域请求，<br>然后检查回复的‘Access-Control-Allow-Origin’头。<br>如果这个头允许该外域访问，则 Javascript 可以读取这个回复，否则就被禁止访问。<br>如果请求不是一个简单的 COR，则向外域服务器发送预检验请求，如果回复的头部允许访问，则发送跨域请求，否则禁止。</p>
<p>下面的 Javascript 会发出预检验请求和真实请求：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language=<span class="string">"Javascript"</span> type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">  <span class="keyword">var</span> client = <span class="keyword">new</span> XMLHttpRequest(); client.open(<span class="string">"GET"</span>, <span class="string">"http://bar.org/b"</span>)</span><br><span class="line">  client.setRequestHeader(<span class="string">'Content-Type'</span>,<span class="string">'text/html'</span>) client.onreadystatechange</span><br><span class="line">  = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;<span class="comment">/* do something */</span>&#125;</span><br><span class="line">  client.send()</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<p>由于“Content-type: text/html”不是一个简单的头，它会先向”<a href="http://bar.org/b&quot;发出一个OPTIONS的HTTP请求。" target="_blank" rel="noopener">http://bar.org/b&quot;发出一个OPTIONS的HTTP请求。</a> 回复可能包含这样的头：</p>
<p>Access-Control-Allow-Origin: <a href="http://foo.org" target="_blank" rel="noopener">http://foo.org</a></p>
<p>Access-Control-Max-Age: 3628800</p>
<p>Access-Control-Allow-Methods: GET，PUT, DELETE</p>
<p>Access-Control-Allow-Headers: content-type</p>
<p>“Access-Control-Allow-Origin”表明它允许”<a href="http://foo.org&quot;发起跨域请求" target="_blank" rel="noopener">http://foo.org&quot;发起跨域请求</a></p>
<p>“Access-Control-Max-Age”表明在 3628800 秒内，不需要再发送预检验请求，可以缓存该结果</p>
<p>“Access-Control-Allow-Methods”表明它允许 GET、PUT、DELETE 的外域请求</p>
<p>“Access-Control-Allow-Headers”表明它允许跨域请求包含 content-type 头</p>
<p>如果预检验请求获得通过，接下来 Javascript 就会发起真实的 COR 请求，过程跟简单的 COR 请求类似。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/06/25/利用Access-Control-Allow-Origin响应头解决跨域请求原理/" data-id="cjtvbojwx000ltqkq69qt3lxw" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-移动web布局适配方法" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/06/10/移动web布局适配方法/" class="article-date">
  <time datetime="2018-06-10T07:23:24.000Z" itemprop="datePublished">2018-06-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/06/10/移动web布局适配方法/">移动web布局适配方法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="常见移动-web-布局适配方法"><a href="#常见移动-web-布局适配方法" class="headerlink" title="常见移动 web 布局适配方法"></a>常见移动 web 布局适配方法</h2><p>固定高度，宽度百分比：这种方法只适合简单要求不高的 webApp，几乎达不到大型项目的要求，属于过时的方法。<br>Media Query（媒体查询）：现在比较主流的适配方案，比如我们常用的样式框架 Bootstrap 就是靠这个起家的，它能完成大部分项目需求，但是编写过于复杂。<br>flex 布局：主流的布局方式，不仅适用于移动 Web，网页上也表现良好，这也是现在工作中用的最多的布局方式，那我们的项目尽量采用 flex+rem 的方式进行布局和完成移动端的适配。</p>
<h3 id="rem-单位介绍"><a href="#rem-单位介绍" class="headerlink" title="rem 单位介绍"></a>rem 单位介绍</h3><p>rem（font size of the root element）是相对长度单位。相对于根元素（即 html 元素）font-size 计算值的倍数。</p>
<blockquote>
<p>适配原理：将 px 替换成 rem，动态修改 html 的 font-size 适配。它可以很好的根据根元素的字体大小来进行变化，从而达到各种屏幕基本一致的效果体验。</p>
</blockquote>
<p>现在我们作一个实验，你可以新建一个网页，并写入如下代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"test"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"hello"</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后给 html 一个基本的样式:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.test</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">320px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">160px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: bisque;</span><br><span class="line">  <span class="attribute">text-align</span>: text；;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.hello</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上边我们使用了还是传统的使用 px 作为单位，我们在移动端调试模式 iphone5 环境查看一下。会发现 div 的宽度是正好的，我们再查看一下字体，发现大小是 16px。</p>
<p>我们现在可以把 CSS 中的 px 单位换成 rem 单位来进行测试。因为 html 根元素的字体大小是 16px，那么换成 rem 单位，直接除以 16 就好。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.test</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">20rem</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">10rem</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: bisque;</span><br><span class="line">  <span class="attribute">text-align</span>: text；;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.hello</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1rem</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="JS-控制适配屏幕"><a href="#JS-控制适配屏幕" class="headerlink" title="JS 控制适配屏幕"></a>JS 控制适配屏幕</h3><p>明白了 REM 的原理后，我们就可以使用这个特点来进行适应布局了，这也是现在比较主流的移动端 web 适配方案。当然你有更好的方案，也可以在文章下方进行留言。<br>三行 JS 代码完成适配：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//得到手机屏幕的宽度</span></span><br><span class="line"><span class="keyword">let</span> htmlWidth =</span><br><span class="line">  <span class="built_in">document</span>.documentElement.clientWidth || <span class="built_in">document</span>.body.clientWidth;</span><br><span class="line"><span class="comment">//得到html的Dom元素</span></span><br><span class="line"><span class="keyword">let</span> htmlDom = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'html'</span>)[<span class="number">0</span>];</span><br><span class="line"><span class="comment">//设置根元素字体大小</span></span><br><span class="line">htmlDom.style.fontSize = htmlWidth / <span class="number">20</span> + <span class="string">'px'</span>;</span><br></pre></td></tr></table></figure>
<h3 id="user-scalable-设置"><a href="#user-scalable-设置" class="headerlink" title="user-scalable 设置"></a>user-scalable 设置</h3><p>在作移动端页面适配时，一般我们不希望用户自己缩放页面大小，我们可以在 index.html 的 meta 标签进行设置，加入 user-scalable=no。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/06/10/移动web布局适配方法/" data-id="cjtvbojx1000qtqkqu4cz51q6" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Mongodb-知识点" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/28/Mongodb-知识点/" class="article-date">
  <time datetime="2018-05-28T07:45:59.000Z" itemprop="datePublished">2018-05-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/28/Mongodb-知识点/">Mongodb-知识点</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li><p>流行的开发框架 LAMP Linux apache mysql／mongodb PHP</p>
</li>
<li><p>Mongodb 的基本概念：mongodb／mongo／索引／集合／复制集／分片数据均衡<br>学会 mongodb 的搭建：<br>部署数据库服务：搭建简单的单机服务——搭建具有冗余容错功能的复制集——搭建大规模数据集群——完成集群的自动部署<br>熟悉 mongodb 的使用：<br>最基本的文档的读写更新删除，<br>各种不同类型的索引的创建与使用，<br>复杂的聚合查询，<br>对数据集合进行分片，<br>在不同分片间维持数据均衡，数据备份与恢复，<br>数据迁移。<br>简单运维：<br>部署 mongodb 集群，<br>处理多种常见的故障：单节点失效，如何恢复工作；数据库意外被杀死如何进行数据恢复；数据库发生拒绝服务时如何排查原因；数据库磁盘快满时如何处理。</p>
</li>
<li><p>数据库的概念：有组织的存放数据，按照不同的需求进行查询。</p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/28/Mongodb-知识点/" data-id="cjtvbojw90001tqkq8wxw8yrz" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-koa2-开发过程随记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/24/koa2-开发过程随记/" class="article-date">
  <time datetime="2018-05-24T07:43:31.000Z" itemprop="datePublished">2018-05-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/24/koa2-开发过程随记/">koa2-开发过程随记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li>安装</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm –save 安装到生产环境</span><br><span class="line">npm –save-dev 安装到开发环境</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>请求页面 <a href="http://localhost:3001/为HTTP" target="_blank" rel="noopener">http://localhost:3001/为HTTP</a> GET 请求</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.info(ctx);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="attr">request</span>:</span><br><span class="line">   &#123; <span class="attr">method</span>: <span class="string">'GET'</span>,</span><br><span class="line">     url: <span class="string">'/'</span>,</span><br><span class="line">     header:</span><br><span class="line">      &#123; <span class="attr">host</span>: <span class="string">'localhost:3001'</span>,</span><br><span class="line">        connection: <span class="string">'keep-alive'</span>,</span><br><span class="line">        <span class="string">'cache-control'</span>: <span class="string">'max-age=0'</span>,</span><br><span class="line">        <span class="string">'upgrade-insecure-requests'</span>: <span class="string">'1'</span>,</span><br><span class="line">        <span class="string">'user-agent'</span>: <span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.139 Safari/537.36'</span>,</span><br><span class="line">        accept: <span class="string">'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8'</span>,</span><br><span class="line">        <span class="string">'accept-encoding'</span>: <span class="string">'gzip, deflate, br'</span>,</span><br><span class="line">        <span class="string">'accept-language'</span>: <span class="string">'zh-CN,zh;q=0.9'</span>,</span><br><span class="line">        cookie: <span class="string">'BIGipServerPOOL_PACLOUD_STGR2017093007195=209847326.34991.0000; BIGipServerPOOL_PACLOUD_STGR2018040304087=461505566.34991.0000'</span> &#125; &#125;,</span><br><span class="line">  response: &#123; <span class="attr">status</span>: <span class="number">404</span>, <span class="attr">message</span>: <span class="string">'Not Found'</span>, <span class="attr">header</span>: &#123;&#125; &#125;,</span><br><span class="line">  app: &#123; <span class="attr">subdomainOffset</span>: <span class="number">2</span>, <span class="attr">proxy</span>: <span class="literal">false</span>, <span class="attr">env</span>: <span class="string">'development'</span> &#125;,</span><br><span class="line">  originalUrl: <span class="string">'/'</span>,</span><br><span class="line">  req: <span class="string">'&lt;original node req&gt;'</span>,</span><br><span class="line">  res: <span class="string">'&lt;original node res&gt;'</span>,</span><br><span class="line">  socket: <span class="string">'&lt;original node socket&gt;'</span> &#125;</span><br><span class="line">&#123; <span class="attr">request</span>:</span><br><span class="line">   &#123; <span class="attr">method</span>: <span class="string">'GET'</span>,</span><br><span class="line">     url: <span class="string">'/favicon.ico'</span>, <span class="comment">// 收藏夹图标</span></span><br><span class="line">     header:</span><br><span class="line">      &#123; <span class="attr">host</span>: <span class="string">'localhost:3001'</span>,</span><br><span class="line">        connection: <span class="string">'keep-alive'</span>,</span><br><span class="line">        <span class="string">'user-agent'</span>: <span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.139 Safari/537.36'</span>,</span><br><span class="line">        accept: <span class="string">'image/webp,image/apng,image/*,*/*;q=0.8'</span>,</span><br><span class="line">        referer: <span class="string">'http://localhost:3001/'</span>,</span><br><span class="line">        <span class="string">'accept-encoding'</span>: <span class="string">'gzip, deflate, br'</span>,</span><br><span class="line">        <span class="string">'accept-language'</span>: <span class="string">'zh-CN,zh;q=0.9'</span>,</span><br><span class="line">        cookie: <span class="string">'BIGipServerPOOL_PACLOUD_STGR2017093007195=209847326.34991.0000; BIGipServerPOOL_PACLOUD_STGR2018040304087=461505566.34991.0000'</span> &#125; &#125;,</span><br><span class="line">  response: &#123; <span class="attr">status</span>: <span class="number">404</span>, <span class="attr">message</span>: <span class="string">'Not Found'</span>, <span class="attr">header</span>: &#123;&#125; &#125;,</span><br><span class="line">  app: &#123; <span class="attr">subdomainOffset</span>: <span class="number">2</span>, <span class="attr">proxy</span>: <span class="literal">false</span>, <span class="attr">env</span>: <span class="string">'development'</span> &#125;,</span><br><span class="line">  originalUrl: <span class="string">'/favicon.ico'</span>,</span><br><span class="line">  req: <span class="string">'&lt;original node req&gt;'</span>,</span><br><span class="line">  res: <span class="string">'&lt;original node res&gt;'</span>,</span><br><span class="line">  socket: <span class="string">'&lt;original node socket&gt;'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li><p>await 必须在 async 方法中才可以使用因为 await 访问本身就会造成程序停止堵塞，所以必须在异步方法中才可以使用。</p>
</li>
<li><p>npm install –save koa-bodyparser@3<br>@3 版本</p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/24/koa2-开发过程随记/" data-id="cjtvbojwp000btqkqpe32w30e" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-webpack-开发过程随记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/23/webpack-开发过程随记/" class="article-date">
  <time datetime="2018-05-23T07:40:20.000Z" itemprop="datePublished">2018-05-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/23/webpack-开发过程随记/">webpack-开发过程随记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="根据模板生成简单的-html-文件"><a href="#根据模板生成简单的-html-文件" class="headerlink" title="根据模板生成简单的 html 文件"></a>根据模板生成简单的 html 文件</h2><p>使用 webpack 根据模板生成 HTML，首先需要安装插件 html-webpack-plugin。在工程文件夹安装插件命令如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install html-webpack-plugin --save-dev</span><br></pre></td></tr></table></figure>
<h2 id="新建-webpack-config-js"><a href="#新建-webpack-config-js" class="headerlink" title="新建 webpack.config.js"></a>新建 webpack.config.js</h2><p>名称可以更改，更改后运行时，需指定配置文件名称。例如，配置文件名为 my.webpack.config.js,　则需要在 package.json 文件中，在 scripts 处添加如下代码:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">"webpack": "webpack --config webapack.config.js --progress --display--modules --colors --dispaly-reason"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译时，需使用 npm run webpack 命令。</p>
<h2 id="webpack-是支持-AMD、CMD、ES6-模块化编程的"><a href="#webpack-是支持-AMD、CMD、ES6-模块化编程的" class="headerlink" title="webpack 是支持 AMD、CMD、ES6 模块化编程的"></a>webpack 是支持 AMD、CMD、ES6 模块化编程的</h2><p>我们是可以使用 require、exports 来获取、返回模块内容的。</p>
<p>在 webpack.prod.conf.js，添加如下代码</p>
<p>我们将原始文件放在 /src/js 文件夹，打包复制后的文件放在 /dist/js 文件夹。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> utils = <span class="built_in">require</span>(<span class="string">'./utils'</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">'../config'</span>)</span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>)</span><br><span class="line"><span class="keyword">const</span> baseWebpackConfig = <span class="built_in">require</span>(<span class="string">'./webpack.base.conf'</span>)</span><br><span class="line"><span class="keyword">const</span> CopyWebpackPlugin = <span class="built_in">require</span>(<span class="string">'copy-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> ExtractTextPlugin = <span class="built_in">require</span>(<span class="string">'extract-text-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> OptimizeCSSPlugin = <span class="built_in">require</span>(<span class="string">'optimize-css-assets-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> UglifyJsPlugin = <span class="built_in">require</span>(<span class="string">'uglifyjs-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> env = <span class="built_in">require</span>(<span class="string">'../config/prod.env'</span>)</span><br><span class="line"><span class="keyword">const</span> webpackConfig = merge(baseWebpackConfig, &#123;</span><br><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">rules: utils.styleLoaders(&#123;</span><br><span class="line">sourceMap: config.build.productionSourceMap,</span><br><span class="line">extract: <span class="literal">true</span>,</span><br><span class="line">usePostCSS: <span class="literal">true</span></span><br><span class="line">&#125;)</span><br><span class="line">&#125;,</span><br><span class="line">devtool: config.build.productionSourceMap ? config.build.devtool : <span class="literal">false</span>,</span><br><span class="line">output: &#123;</span><br><span class="line">path: config.build.assetsRoot,</span><br><span class="line">filename: utils.assetsPath(<span class="string">'js/[name].[chunkhash].js'</span>),</span><br><span class="line">chunkFilename: utils.assetsPath(<span class="string">'js/[id].[chunkhash].js'</span>)</span><br><span class="line">&#125;,</span><br><span class="line">plugins: [</span><br><span class="line"><span class="comment">// http://vuejs.github.io/vue-loader/en/workflow/production.html</span></span><br><span class="line"><span class="keyword">new</span> webpack.DefinePlugin(&#123;</span><br><span class="line"><span class="string">'process.env'</span>: env</span><br><span class="line">&#125;),</span><br><span class="line"><span class="keyword">new</span> UglifyJsPlugin(&#123;</span><br><span class="line"><span class="comment">// 压缩 js 文件，内置插件</span></span><br><span class="line">uglifyOptions: &#123;</span><br><span class="line">comcodess: &#123;</span><br><span class="line">warnings: <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">sourceMap: config.build.productionSourceMap,</span><br><span class="line">parallel: <span class="literal">true</span></span><br><span class="line">&#125;),</span><br><span class="line"><span class="comment">// extract css into its own file</span></span><br><span class="line"><span class="keyword">new</span> ExtractTextPlugin(&#123;</span><br><span class="line"><span class="comment">// 提取 css 到单独的文件</span></span><br><span class="line">filename: utils.assetsPath(<span class="string">'css/[name].[contenthash].css'</span>),</span><br><span class="line"><span class="comment">// Setting the following option to `false` will not extract CSS from codesplit chunks.</span></span><br><span class="line"><span class="comment">// Their CSS will instead be inserted dynamically with style-loader when the codesplit chunk has been loaded by webpack.</span></span><br><span class="line"><span class="comment">// It's currently set to `true` because we are seeing that sourcemaps are included in the codesplit bundle as well when it's `false`,</span></span><br><span class="line"><span class="comment">// increasing file size: https://github.com/vuejs-templates/webpack/issues/1110</span></span><br><span class="line">allChunks: <span class="literal">true</span></span><br><span class="line">&#125;),</span><br><span class="line"><span class="comment">// Comcodess extracted CSS. We are using this plugin so that possible</span></span><br><span class="line"><span class="comment">// duplicated CSS from different components can be deduped.</span></span><br><span class="line"><span class="keyword">new</span> OptimizeCSSPlugin(&#123;</span><br><span class="line">cssProcessorOptions: config.build.productionSourceMap</span><br><span class="line">? &#123; <span class="attr">safe</span>: <span class="literal">true</span>, <span class="attr">map</span>: &#123; <span class="attr">inline</span>: <span class="literal">false</span> &#125; &#125;</span><br><span class="line">: &#123; <span class="attr">safe</span>: <span class="literal">true</span> &#125;</span><br><span class="line">&#125;),</span><br><span class="line"><span class="comment">// generate dist index.html with correct asset hash for caching.</span></span><br><span class="line"><span class="comment">// you can customize output by editing /index.html</span></span><br><span class="line"><span class="comment">// see https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class="line"><span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">filename: config.build.index,</span><br><span class="line">templateParameters: &#123;</span><br><span class="line">property: <span class="literal">true</span> <span class="comment">// 开发环境需设置为 false</span></span><br><span class="line">&#125;,</span><br><span class="line">title:<span class="string">'这个是 WebPack Demo'</span>,</span><br><span class="line">template: <span class="string">'index.html'</span>,</span><br><span class="line">inject: <span class="literal">true</span>,</span><br><span class="line">minify: &#123;</span><br><span class="line">removeComments: <span class="literal">true</span>, <span class="comment">// 移除 HTML 中的注释</span></span><br><span class="line">collapseWhitespace: <span class="literal">true</span>, <span class="comment">// 删除空白符与换行符</span></span><br><span class="line">removeAttributeQuotes: <span class="literal">true</span></span><br><span class="line"><span class="comment">// more options:</span></span><br><span class="line"><span class="comment">// https://github.com/kangax/html-minifier#options-quick-reference</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// necessary to consistently work with multiple chunks via CommonsChunkPlugin</span></span><br><span class="line">chunksSortMode: <span class="string">'dependency'</span></span><br><span class="line">&#125;),</span><br><span class="line"><span class="comment">// keep module.id stable when vendor modules does not change</span></span><br><span class="line"><span class="keyword">new</span> webpack.HashedModuleIdsPlugin(),</span><br><span class="line"><span class="comment">// enable scope hoisting</span></span><br><span class="line"><span class="keyword">new</span> webpack.optimize.ModuleConcatenationPlugin(),</span><br><span class="line"><span class="comment">// split vendor js into its own file</span></span><br><span class="line"><span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">name: <span class="string">'vendor'</span>,</span><br><span class="line">minChunks (<span class="built_in">module</span>) &#123;</span><br><span class="line"><span class="comment">// any required modules inside node_modules are extracted to vendor</span></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line"><span class="built_in">module</span>.resource &amp;&amp;</span><br><span class="line">/\.js$/.test(<span class="built_in">module</span>.resource) &amp;&amp;</span><br><span class="line"><span class="built_in">module</span>.resource.indexOf(path.join(\_\_dirname, <span class="string">'../node_modules'</span>)) === <span class="number">0</span></span><br><span class="line">)</span><br><span class="line">&#125;</span><br><span class="line">&#125;),</span><br><span class="line"><span class="comment">// extract webpack runtime and module manifest to its own file in order to</span></span><br><span class="line"><span class="comment">// codevent vendor hash from being updated whenever app bundle is updated</span></span><br><span class="line"><span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">name: <span class="string">'manifest'</span>,</span><br><span class="line">minChunks: <span class="literal">Infinity</span></span><br><span class="line">&#125;),</span><br><span class="line"><span class="comment">// This instance extracts shared chunks from code splitted chunks and bundles them</span></span><br><span class="line"><span class="comment">// in a separate chunk, similar to the vendor chunk</span></span><br><span class="line"><span class="comment">// see: https://webpack.js.org/plugins/commons-chunk-plugin/#extra-async-commons-chunk</span></span><br><span class="line"><span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">name: <span class="string">'app'</span>,</span><br><span class="line"><span class="keyword">async</span>: <span class="string">'vendor-async'</span>,</span><br><span class="line">children: <span class="literal">true</span>,</span><br><span class="line">minChunks: <span class="number">3</span></span><br><span class="line">&#125;),</span><br><span class="line">    <span class="comment">// copy custom static assets</span></span><br><span class="line">    <span class="keyword">new</span> CopyWebpackPlugin([</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">from</span>: path.resolve(__dirname, <span class="string">'../static'</span>),</span><br><span class="line">        to: config.build.assetsSubDirectory,</span><br><span class="line">        ignore: [<span class="string">'.*'</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    ])</span><br><span class="line">]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">if</span> (config.build.productionGzip) &#123;</span><br><span class="line"><span class="keyword">const</span> ComcodessionWebpackPlugin = <span class="built_in">require</span>(<span class="string">'comcodession-webpack-plugin'</span>) <span class="comment">// 压缩 gzip</span></span><br><span class="line">webpackConfig.plugins.push(</span><br><span class="line"><span class="keyword">new</span> ComcodessionWebpackPlugin(&#123;</span><br><span class="line">asset: <span class="string">'[path].gz[query]'</span>,</span><br><span class="line">algorithm: <span class="string">'gzip'</span>,</span><br><span class="line">test: <span class="keyword">new</span> <span class="built_in">RegExp</span>(</span><br><span class="line"><span class="string">'\\.('</span> + config.build.productionGzipExtensions.join(<span class="string">'|'</span>) + <span class="string">')$'</span></span><br><span class="line">),</span><br><span class="line">threshold: <span class="number">10240</span>,</span><br><span class="line">minRatio: <span class="number">0.8</span></span><br><span class="line">&#125;)</span><br><span class="line">)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (config.build.bundleAnalyzerReport) &#123;</span><br><span class="line"><span class="keyword">const</span> BundleAnalyzerPlugin = <span class="built_in">require</span>(<span class="string">'webpack-bundle-analyzer'</span>)</span><br><span class="line">.BundleAnalyzerPlugin</span><br><span class="line">webpackConfig.plugins.push(<span class="keyword">new</span> BundleAnalyzerPlugin())</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = webpackConfig</span><br></pre></td></tr></table></figure>
<p>我们可以在模板 index.html 书写类似 PHP、ASP.net 的语法格式。</p>
<p>模板 index.html 文件模板内容</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">%</span> <span class="attr">if</span> (<span class="attr">htmlWebpackPlugin.options.templateParameters.property</span>)&#123;%&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">"/abc/"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">%&#125;%</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;<span class="name">%=htmlWebpackPlugin.options.title%</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span></span></span><br><span class="line"><span class="tag">      <span class="attr">type</span>=<span class="string">"text/javascript"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">src</span>=<span class="string">"&lt;%=htmlWebpackPlugin.files.chunks.main.entry%&gt;"</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">code</span>&gt;</span></span><br><span class="line">      :<span class="tag">&lt;<span class="name">=JSON.stringify(htmlWebpackPlugin.files[key])</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">%</span> <span class="attr">for</span>(<span class="attr">var</span> <span class="attr">key</span> <span class="attr">in</span> <span class="attr">htmlWebpackPlugin.options</span>)&#123;%&gt;</span> <span class="tag">&lt;<span class="name">%=key</span></span></span><br><span class="line"><span class="tag">      %&gt;</span>:<span class="tag">&lt;<span class="name">%=JSON.stringify(htmlWebpackPlugin.options[key])%</span>&gt;</span> <span class="tag">&lt;<span class="name">%&#125;%</span>&gt;</span> <span class="tag">&lt;<span class="name">%</span> <span class="attr">for</span>(<span class="attr">var</span></span></span><br><span class="line"><span class="tag">      <span class="attr">key</span> <span class="attr">in</span> <span class="attr">htmlWebpackPlugin.files</span>)&#123;%&gt;</span> <span class="tag">&lt;<span class="name">%=key</span></span></span><br><span class="line"><span class="tag">      %&gt;</span>:<span class="tag">&lt;<span class="name">%=JSON.stringify(htmlWebpackPlugin.files[key])%</span>&gt;</span> <span class="tag">&lt;<span class="name">%&#125;%</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">script</span></span></span><br><span class="line"><span class="tag">        <span class="attr">type</span>=<span class="string">"text/javascript"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">src</span>=<span class="string">"&lt;%=htmlWebpackPlugin.files.chunks.a.entry%&gt;"</span></span></span><br><span class="line"><span class="tag">      &gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">code</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>运行 webpack，即可生成 HTML 文件 。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/23/webpack-开发过程随记/" data-id="cjtvbojwt000ftqkqufyvdpsp" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-vue-开发过程随记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/10/vue-开发过程随记/" class="article-date">
  <time datetime="2018-04-10T07:36:44.000Z" itemprop="datePublished">2018-04-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/10/vue-开发过程随记/">vue-开发过程随记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li>父组件利用 props 往子组件传输数据父组件：<br>注意传递参数时要用—代替驼峰命名，HTML 不区分大小写<br>子组件：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Vue.component(‘child’, &#123;</span><br><span class="line">// camelCase in JavaScript</span><br><span class="line">props:&#123;myMessage&#125;,</span><br><span class="line">template: ‘‘</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>当 props 中接收的是父组件传递的引用类型（对象或者是数组）时，在子组件中对数据改变时，父组件中的数据也会相应的改变，因为两者是指向的同一地址内存。如果不想子组件的改变影响父组件可以利用深拷贝，将接受的数据进行深拷贝后在子组件中使用，而不直接操作接受的数据。深拷贝可以直接利用 ES6 中的 obj=Object.assign（{},myMessage）（在 computed 中定义），这样子组件的改动将不会影响到父组件。</p>
<ol start="2">
<li>ref 属性当 ref 直接定义在 dom 元素上时，则通过 this.\$refs.name 可以获取到 dom 对 dom 进行原生的操作</li>
</ol>
<p>通过 this.\$refs 获取到 dom 进行操作（注意 ref 属性的命名不能用驼峰，同时获取的时候也是）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> menuList=<span class="keyword">this</span>.$refs[‘menu-wrapper’].getElementsByClassName(‘menu-list-hook’);<span class="comment">//此处如果用 this.$refs[“menuWrapper”]将获取不到元素</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>v-bind = class: item.flag, v-bind= class: item[index]<br>对象或者数组都无法动态关联到 data 中，通过设置 v-bind= class: item === index,即可关联到。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-form-item</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-for</span>=<span class="string">"(item, key) in fieldCnNames.filter(item =&gt; item.field !== 'pid' &amp;&amp; item.field !== 'created_date' &amp;&amp; item.field !== 'created_by' &amp;&amp; item.field !== 'updated_date' &amp;&amp; item.field !== 'updated_by')"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:key</span>=<span class="string">"key"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:label</span>=<span class="string">"item.fieldchnname"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:prop</span>=<span class="string">"item.field"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:class</span>=<span class="string">"item.isDifferVal ? 'differ-hightligh' : 'same-normal'"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:class</span>=<span class="string">"isHighlightObj[item.field] ? 'differ-hightligh' : 'same-normal'"</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-input</span></span></span><br><span class="line"><span class="tag">    <span class="attr">clearable</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">change</span>=<span class="string">"val =&gt; handleChange(val, item, key)"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-model</span>=<span class="string">"resultDataObj[item.field]"</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在 handleChange 中改变 fieldCnNames 中 isDifferVal 的值，可以在 html 中实时跟踪到 val 值的变化。<br>然而，通过 isHighlightObj[item.field]却无法实时跟踪到 val 值的变化。只有当点击或者下次 handleChange 触发时，<br>才会在 html 中跟踪到上一次 val 改变的状态。</p>
<p>v-for 中必须注意这一点。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// el-input中显示0</span></span><br><span class="line"><span class="keyword">if</span> (formData[item] !== <span class="literal">null</span>) &#123;</span><br><span class="line">  formData[item] = formData[item].toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/10/vue-开发过程随记/" data-id="cjtvbojwn000atqkqqtn5r21p" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-http协议" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/03/30/http协议/" class="article-date">
  <time datetime="2018-03-30T09:47:08.000Z" itemprop="datePublished">2018-03-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/03/30/http协议/">http协议</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="简单的-HTTP-协议"><a href="#简单的-HTTP-协议" class="headerlink" title="简单的 HTTP 协议"></a>简单的 HTTP 协议</h2><h3 id="使用-Cookie-的状态管理"><a href="#使用-Cookie-的状态管理" class="headerlink" title="使用 Cookie 的状态管理"></a>使用 Cookie 的状态管理</h3><p>为了尽快处理大量事务，HTTP 被设计为不保存状态的协议。<br>在多页面切换时，需要保存用户的状态，因此引入了 Cookie 技术。</p>
<blockquote>
<p>Cookie 通过在请求和响应报文中写入 Cookie 信息来控制客户端的状态。</p>
</blockquote>
<ol>
<li><p>首先，在没有 Cookie 信息状态下，客户端发出 HTTP 请求。服务器会生成 Cookie，并通过在响应报文中添加 Set-Cookie 的首部字段，来通知客户端保存 Cookie。</p>
</li>
<li><p>下次客户端再往服务器发送请求时，客户端会自动在请求报文中加入 Cookie 值后再发送出去。</p>
</li>
</ol>
<h3 id="持久连接节省通信量"><a href="#持久连接节省通信量" class="headerlink" title="持久连接节省通信量"></a>持久连接节省通信量</h3><p>当文档中包含有大量图片时，每进行一次 HTTP 请求就断开 TCP 连接，增加了通信量的开销。</p>
<p>通过设置 Connection: keep-alive，实现了只要任意一端没有明确提出断开连接，则保持 TCP 连接状态。</p>
<p>持久连接的益处在于：</p>
<ul>
<li>减少 TCP 连接重复建立和断开所造成的额外开销，减轻服务器负担；</li>
<li>HTTP 请求和响应更快结束，页面能尽快的显示处理。</li>
</ul>
<h2 id="返回结果的状态码"><a href="#返回结果的状态码" class="headerlink" title="返回结果的状态码"></a>返回结果的状态码</h2><p>1XX 接收的请求正在处理<br>2XX 请求正常处理完毕<br>3XX 重定向状态码，需要附加操作以完成请求<br>4XX 服务器无法处理请求<br>5XX 服务器处理请求出错</p>
<p>301 永久重定向<br>302 临时重定向<br>304 服务器资源未改变，可直接使用客户端未过期的缓存<br>404 服务器上没有请求的资源</p>
<h2 id="HTTP-首部"><a href="#HTTP-首部" class="headerlink" title="HTTP 首部"></a>HTTP 首部</h2><ol>
<li>通用首部字段</li>
</ol>
<p>Connection 连接的管理</p>
<ol start="2">
<li>请求首部字段<br>Accept 用户代理可处理的媒体类型<br>Accept-Encoding 优先的内容编码<br>Authorization Web 认证信息</li>
<li>响应首部字段</li>
<li>实体首部字段<br>Content-Type 实体主体的媒体类型</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/03/30/http协议/" data-id="cjtvbojwm0008tqkqe5i4uynl" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/03/29/vue项目中mixins复用/">vue项目中mixins复用</a>
          </li>
        
          <li>
            <a href="/2019/03/28/vue项目优化/">vue项目优化</a>
          </li>
        
          <li>
            <a href="/2019/03/26/jenkins-教程/">jenkins 教程</a>
          </li>
        
          <li>
            <a href="/2019/03/20/React高阶组件/">React高阶组件</a>
          </li>
        
          <li>
            <a href="/2019/03/13/sql查询语句/">sql查询语句</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>